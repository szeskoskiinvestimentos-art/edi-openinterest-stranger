// NTSL Indicator - Edi OpenInterest Levels
// Gerado Automaticamente

const
  clCallWall = clBlue;
  clPutWall = clRed;
  clGammaFlip = clFuchsia;
  clDeltaFlip = clYellow;
  clRangeHigh = clLime;
  clRangeLow = clRed;
  clMaxPain = clPurple;
  clExpMove = clWhite;
  clEdiWall = clSilver;
  clFib = clYellow;
  TamanhoFonte = 8;

input
  ExibirWalls(true);
  ExibirFlips(true);
  ExibirRange(true);
  ExibirMaxPain(true);
  ExibirExpMoves(true);
  ExibirEdiWall(true);
  MostrarPLUS(true);
  MostrarPLUS2(true);
  ModeloFlip(1); // Selecione o modelo de Gamma Flip abaixo
  // 1 = Classic
  // 2 = Spline

  refFechamento(5418.00);  // Fechamento spot
  Taxa_Selic(15.0); // Taxa Selic anual
  Taxa_Fed(3.5);   // Juros EUA ou Diferencial
  // 1 = Classic (5350.00)
  // 2 = Spline (5350.00)
  // 3 = HVL (5350.00)
  // 4 = HVL Log (5350.00)
  // 5 = Sigma Kernel (5350.00)
  // 6 = PVOP (5350.00)

var
  GammaVal: Float;
  vBase, vRisco : Float;
  Res1, Res2, Res3, Res4 : Float;
  Sup1, Sup2, Sup3, Sup4 : Float;

begin
  // Inicializa GammaVal com o primeiro disponivel por seguranca
  GammaVal := 5350.00;

  if (ModeloFlip = 1) then GammaVal := 5350.00;
  if (ModeloFlip = 2) then GammaVal := 5350.00;
  if (ModeloFlip = 3) then GammaVal := 5350.00;
  if (ModeloFlip = 4) then GammaVal := 5350.00;
  if (ModeloFlip = 5) then GammaVal := 5350.00;
  if (ModeloFlip = 6) then GammaVal := 5350.00;

  // --- Linhas Principais (Com Intercalação de Texto) ---
  if (ExibirWalls) then
    HorizontalLineCustom(5350.00, clPutWall, 1, psDash, "PutWall", TamanhoFonte, tpTopLeft, 0, 0);
  if (ExibirWalls) then
    HorizontalLineCustom(5375.00, clPutWall, 1, psDash, "PutWall", TamanhoFonte, tpTopLeft, 0, 0);
  if (ExibirRange) then
    HorizontalLineCustom(5378.51, clRangeLow, 1, psDot, "Edi_Range", TamanhoFonte, tpTopRight, 0, 0);
  if (ExibirExpMoves) then
    HorizontalLineCustom(5378.51, clExpMove, 1, psDot, "Edi_ExpMove", TamanhoFonte, tpBottomRight, CurrentDate, 0);
  if (ExibirWalls) then
    HorizontalLineCustom(5425.00, clPutWall, 1, psDash, "PutWall", TamanhoFonte, tpTopLeft, 0, 0);
  if (ExibirMaxPain) then
    HorizontalLineCustom(5425.00, clMaxPain, 2, psSolid, "Edi_MaxPain", TamanhoFonte, tpTopRight, CurrentDate, 0);
  if (ExibirExpMoves) then
    HorizontalLineCustom(5457.49, clExpMove, 1, psDot, "Edi_ExpMove", TamanhoFonte, tpTopRight, CurrentDate, 0);
  if (ExibirRange) then
    HorizontalLineCustom(5457.49, clRangeHigh, 1, psDot, "Edi_Range", TamanhoFonte, tpBottomRight, 0, 0);
  if (ExibirWalls) then
    HorizontalLineCustom(5650.00, clCallWall, 1, psDash, "CallWall", TamanhoFonte, tpTopLeft, 0, 0);

  // Flips (Dinâmicos)
  if (ExibirFlips) then begin
    if (GammaVal > 0) then
      HorizontalLineCustom(GammaVal, clGammaFlip, 2, psDash, "Edi_GammaFlip", TamanhoFonte, tpTopRight, CurrentDate, 0);
    if (5848.34 > 0) then
      HorizontalLineCustom(5848.34, clDeltaFlip, 2, psDash, "Edi_DeltaFlip", TamanhoFonte, tpTopRight, CurrentDate, 0);
  end;

  // Edi_Wall (Midpoints) - Grid Completo
  if (ExibirEdiWall) then begin
    HorizontalLineCustom(5362.50, clEdiWall, 1, psDash, "Edi_Wall", TamanhoFonte, tpTopLeft, CurrentDate, 0);
    HorizontalLineCustom(5400.00, clEdiWall, 1, psDash, "Edi_Wall", TamanhoFonte, tpTopLeft, CurrentDate, 0);
    HorizontalLineCustom(5537.50, clEdiWall, 1, psDash, "Edi_Wall", TamanhoFonte, tpTopLeft, CurrentDate, 0);
  end;

  if (MostrarPLUS) then begin
    HorizontalLineCustom(5359.55, clFib, 1, psDash, "Edi_Wall", TamanhoFonte, tpTopLeft, CurrentDate, 0);
    HorizontalLineCustom(5365.45, clFib, 1, psDash, "Edi_Wall", TamanhoFonte, tpTopLeft, CurrentDate, 0);
    HorizontalLineCustom(5394.10, clFib, 1, psDash, "Edi_Wall", TamanhoFonte, tpTopLeft, CurrentDate, 0);
    HorizontalLineCustom(5405.90, clFib, 1, psDash, "Edi_Wall", TamanhoFonte, tpTopLeft, CurrentDate, 0);
    HorizontalLineCustom(5510.95, clFib, 1, psDash, "Edi_Wall", TamanhoFonte, tpTopLeft, CurrentDate, 0);
    HorizontalLineCustom(5564.05, clFib, 1, psDash, "Edi_Wall", TamanhoFonte, tpTopLeft, CurrentDate, 0);
  end;

  if (MostrarPLUS2) then begin
    HorizontalLineCustom(5355.90, clFib, 1, psDash, "Edi_Wall", TamanhoFonte, tpTopLeft, CurrentDate, 0);
    HorizontalLineCustom(5369.10, clFib, 1, psDash, "Edi_Wall", TamanhoFonte, tpTopLeft, CurrentDate, 0);
    HorizontalLineCustom(5386.80, clFib, 1, psDash, "Edi_Wall", TamanhoFonte, tpTopLeft, CurrentDate, 0);
    HorizontalLineCustom(5413.20, clFib, 1, psDash, "Edi_Wall", TamanhoFonte, tpTopLeft, CurrentDate, 0);
    HorizontalLineCustom(5478.10, clFib, 1, psDash, "Edi_Wall", TamanhoFonte, tpTopLeft, CurrentDate, 0);
    HorizontalLineCustom(5596.90, clFib, 1, psDash, "Edi_Wall", TamanhoFonte, tpTopLeft, CurrentDate, 0);
  end;

  // --- Estratégia Borboleta (Resistências e Suportes) ---
  if (refFechamento > 0) then
  begin
    // Cálculo das Variações conforme Engenharia Reversa
    vBase := refFechamento * (Taxa_Selic / 10000);
    vRisco := vBase / (Taxa_Fed / 10);

    // --- HIERARQUIA DE RESISTÊNCIAS (ALTA) ---
    Res1 := refFechamento + vBase;    // Vértice Principal 1
    Res2 := Res1 + vBase;             // Vértice Principal 2 (Quebra de Constante)
    Res3 := Res1 + vRisco;            // Vértice Secundária (Paredão F25)
    Res4 := Res3 + vBase;             // Vértice Avançada (Exaustão)

    // --- HIERARQUIA DE SUPORTES (BAIXA) ---
    Sup1 := refFechamento - vBase;    // Vértice Principal 1
    Sup2 := Sup1 - vBase;             // Vértice Principal 2
    Sup3 := Sup1 - vRisco;            // Vértice Secundária (Paredão F25)
    Sup4 := Sup3 - vBase;             // Vértice Avançada (Exaustão)

    if LastBarOnChart then
    begin
      HorizontalLineCustom(Res1, clRed, 1, psDash, "Edi_Wall_Venda", TamanhoFonte, tpTopRight, CurrentDate, CurrentTime, 0.1);
      HorizontalLineCustom(Sup1, clLime, 1, psDash, "Edi_Wall_Compra", TamanhoFonte, tpTopRight, CurrentDate, CurrentTime, 0.1);
      HorizontalLineCustom(Res2, clRed, 1, psDash, "Edi_Wall_MelhorVenda", TamanhoFonte, tpTopRight, CurrentDate, CurrentTime, 0.3);
      HorizontalLineCustom(Sup2, clLime, 1, psDash, "Edi_Wall_MelhorCompra", TamanhoFonte, tpTopRight, CurrentDate, CurrentTime, 0.3);
      HorizontalLineCustom(Res3, clRed, 1, psDash, "Edi_Wall_MelhorVenda", TamanhoFonte, tpTopRight, CurrentDate, CurrentTime, 0.5);
      HorizontalLineCustom(Sup3, clLime, 1, psDash, "Edi_Wall_MelhorCompra", TamanhoFonte, tpTopRight, CurrentDate, CurrentTime, 0.5);
      HorizontalLineCustom(Res4, clRed, 1, psDash, "Edi_Wall_MelhorVenda", TamanhoFonte, tpTopRight, CurrentDate, CurrentTime, 0.7);
      HorizontalLineCustom(Sup4, clLime, 1, psDash, "Edi_Wall_MelhorCompra", TamanhoFonte, tpTopRight, CurrentDate, CurrentTime, 0.7);
    end;
  end;
end;